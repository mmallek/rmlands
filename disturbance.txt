DEFINE treat_null [treat = null][agemanage = null][agetreat = null][sheltstage = null];
DEFINE wfire_high [agewfireh = 0][agewfirel = null][agewfire = 0][wfirefreqh +1];
DEFINE wfire_low [agewfirel = 0][agewfire = 0][wfirefreql +1];
DEFINE pdec_null [pdecmort = null][agepdech = null][agepdecl = null][agepdec = null];
DEFINE mtpb_null [mtpbmort = null][agemtpbh = null][agemtpbl = null][agemtpb = null];
DEFINE dfbb_null [dfbbmort = null][agedfbbh = null][agedfbbl = null][agedfbb = null];
DEFINE sbb_null [sbbmort = null][agesbbh = null][agesbbl = null][agesbb = null];
DEFINE sbud_null [sbudmort = null][agesbudh = null][agesbudl = null][agesbud = null];
DEFINE wfire_null [wfiremort = null][agewfireh = null][agewfirel = null][agewfire = null];

<wildfire>
// CMM: curl-leaf mountain mahogany
// Mid open to closed only

// If cover is CMM and condition is ANY and age since high mortality wildfire is 0
// (This means if a high mortality wildfire just took place)
IF [cover = CMM][condition = EARLY_ALL|MID_CL|MID_OP|LATE_ALL][agewfireh = 0]
// Then that patch will have its condition reset to ED, and age, condage, and stageage are reset to 0
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];
// If cover is mid closed, and there is a low mortality wildfire
IF [cover = CMM][condition = MID_CL][agewfirel = 0]
// Then there is a probability of 0.286 that the patch will transition to mid open and condage reset to 0
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.286]

// DFTO: doug fir tan oak
// No closed to open
IF [cover = DFTO][condition = EARLY_ALL|MID_ALL|LATE_ALL][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];

// DFTO_U: doug fir tan oak - ultramafic
// No closed to open
IF [cover = DFTO_U][condition = EARLY_ALL|MID_ALL|LATE_ALL][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];

// LPN: lodgepole pine
// Mid closed to open only (prob = 1)
IF [cover = LPN][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];
IF [cover = LPN][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0];

// LPN_ASP: lodgepole with aspen
// Late closed to open only
IF [cover = LPN_ASP][condition = EARLY_ASP|MID_ASP|MID_AC|LATE_CL|LATE_CA][agewfireh = 0]
     THEN [condition = EARLY_ASP][age = 0][condage = 0][stageage = 0];
IF [cover = LPN_ASP][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_CA][condage = 0]
          USE [prob = 0.15];

// LSG: black and low sagebrush
// No closed to open
IF [cover = LSG][condition = EARLY_ALL|MID_ALL|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];

// MHW: montane hardwood
// No closed to open
IF [cover = MHW][condition = EARLY_ALL|MID_ALL|LATE_ALL][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     

// MHW_U: montane hardwood - ultramafic
// No closed to open
IF [cover = MHW_U][condition = EARLY_ALL|MID_ALL|LATE_ALL][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     

// MRIP: montane riparian
// No closed to open
IF [cover = MRIP][condition = EARLY_ALL|MID_ALL|LATE_ALL][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0]; 

// OAK: oak woodland
// Late closed to open only (prob = 1)
IF [cover = OAK][condition = EARLY_ALL|MID_ALL|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];
IF [cover = OAK][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_OP][condage = 0];

// OCFW: oak-conifer forest and woodland
// Mid closed to open only
IF [cover = OCFW][condition = EARLY_ALL|MID_CL|MID_OP|LATE_ALL][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];
IF [cover = OCFW][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.133];

// OCFW: oak-conifer forest and woodland - ultramafic
// Mid closed to open only
IF [cover = OCFW_U][condition = EARLY_ALL|MID_CL|MID_OP|LATE_ALL][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];
IF [cover = OCFW_U][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.7];

// RFR_M: red fir - mesic
// Mid, Late closed to open
IF [cover = RFR_M][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     
IF [cover = RFR_M][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.833];
IF [cover = RFR_M][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_OP][condage = 0]
          USE [prob = 0.55];

// RFR_X: red fir - xeric
// Mid, Late closed to open
IF [cover = RFR_X][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     
IF [cover = RFR_X][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.883];
IF [cover = RFR_X][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_OP][condage = 0]
          USE [prob = 0.55];

// RFR_U:red fir - ultramafic
// Mid, Late closed to open
IF [cover = RFR_U][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     
IF [cover = RFR_U][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.074];
IF [cover = RFR_U][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_OP][condage = 0]
          USE [prob = 0.074];

// RFR_ASP: red fir - aspen
IF [cover = RFR_ASP][condition = EARLY_ASP|MID_ASP|MID_AC|LATE_CL|LATE_CA][agewfireh = 0]
     THEN [condition = EARLY_ASP][age = 0][condage = 0][stageage = 0];
IF [cover = RFR_ASP][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_CA][condage = 0]
          USE [prob = 0.15];

// SAGE: big sagebrush
IF [cover = SAGE][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     

// SCN: subalpine conifer
// Mid closed to open only (prob=1)
IF [cover = SCN][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     
IF [cover = SCN][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]

// SCN_ASP: subalpine conifer - aspen     
IF [cover = SCN_ASP][condition = EARLY_ASP|MID_ASP|LATE_CA][agewfireh = 0]
     THEN [condition = EARLY_ASP][age = 0][condage = 0][stageage = 0];

// SMC_M: sierran mixed conifer - mesic
// Mid, Late closed to open
IF [cover = SMC_M][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     
IF [cover = SMC_M][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.413];
IF [cover = SMC_M][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_OP][condage = 0]
          USE [prob = 0.299];

// SMC_X: sierran mixed conifer - xeric
// Mid, Late closed to open
IF [cover = SMC_X][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     
IF [cover = SMC_X][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.514];
IF [cover = SMC_X][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_OP][condage = 0]
          USE [prob = 0.076];

// SMC_U: sierran mixed conifer - ultramafic
// Mid, Late closed to open
IF [cover = SMC_U][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     
IF [cover = SMC_U][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.074];
IF [cover = SMC_U][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_OP][condage = 0]
          USE [prob = 0.074];

// SMC_ASP: sierran mixed conifer - aspen
// Late closed to open
IF [cover = SMC_ASP][condition = EARLY_ASP|MID_ASP|MID_AC|LATE_CL|LATE_CA][agewfireh = 0]
     THEN [condition = EARLY_ASP][age = 0][condage = 0][stageage = 0];
IF [cover = SMC_ASP][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_CA][condage = 0]
          USE [prob = 0.15];

// WWP: western white pine
IF [cover = WWP][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     
IF [cover = WWP][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.8];
IF [cover = WWP][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_OP][condage = 0]
          USE [prob = 0.8];

// YPN: yellow pine
IF [cover = YPN][condition = EARLY_ALL|MID_CL|MID_OP|LATE_CL|LATE_OP][agewfireh = 0]
     THEN [condition = EARLY_ALL][age = 0][condage = 0][stageage = 0];     
IF [cover = YPN][condition = MID_CL][agewfirel = 0]
     THEN [condition = MID_OP][condage = 0]
          USE [prob = 0.519];
IF [cover = YPN][condition = LATE_CL][agewfirel = 0]
     THEN [condition = LATE_OP][condage = 0]
          USE [prob = 0.313];

// YPN_ASP: yellow pine - aspen
IF [cover = YPN_ASP][condition = EARLY_ASP|MID_ASP|LATE_CA][agewfireh = 0]
     THEN [condition = EARLY_ASP][age = 0][condage = 0][stageage = 0];

</wildfire>

